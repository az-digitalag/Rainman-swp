---
title: "Initial data exploration"
author: "Jessica Guo"
date: "3/31/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Soil data from RainMan SR

This project uses soil volumentric water content (VWC) and temperature (Ts) data from the RainManSR project to predict soil water potential (SWP), which is available from a subset of plots/treatments. The project goals are two-fold: 1) to extract Van Genuchten model parameters for use in predicting SWP mechanistically, using model such as Hydrus 1D, and 2) to develop a statistical model of SWP using VWC in a hierarhical Bayesian framework and predict the missing values of SWP for other plots/treatments. 

```{r library}
library(xts)
library(dplyr)
library(ggplot2)
```

## Data exploration

The data are recorded as halfhourly time series. Depths 1 - 3 correspond with 0-12 cm, 25 cm, and 75 cm respectively. VWC data is provided along with SWP and environmental data of air temperature and RH, both inside and outside the houses. 

```{r data_in_ggplot}
Ts <- read.csv("../data/Halfhourly_TS_0113.csv") %>%
  dplyr::select(-X) %>%
  mutate(TIMESTAMP = as.POSIXct(TIMESTAMP)) %>%
  rename(dt = TIMESTAMP) %>%
  tidyr::pivot_longer(!dt, names_to = c("Plot", "Depth", "House"), 
                      names_pattern = "TS_P(.*)_(.*)_H(.*)") %>%
  mutate(House = factor(as.numeric(House)),
         Depth = factor(as.numeric(Depth)),
         Plot = factor(as.numeric(Plot)))

WC <- read.csv("../data/Halfhourly_VWC_Weather_030621.csv") %>%
  dplyr::select(-X) %>%
  mutate(TIMESTAMP = as.POSIXct(TIMESTAMP)) %>%
  rename(dt = TIMESTAMP) %>%
  tidyr::pivot_longer(!c(dt, T_inside, RH_inside, T_outside, RH_outside), 
                      names_to = c("Variable", "Plot", "Depth", "House"), 
                      names_pattern = "(.*)_P(.*)_(.*)_H(.*)")
```

```{r ggplot, echo = FALSE}
ggplot(Ts, aes(x = dt, y = value)) +
  geom_point(aes(color = Depth), size = 0.5) +
  facet_wrap(~House, ncol = 7)
```

Data are read into the xts format, which has extensive plotting capabilities
```{r data_in_xts}
Ts <- read.csv("../data/Halfhourly_TS_0113.csv") %>%
  dplyr::select(-X) %>%
  mutate(TIMESTAMP = as.POSIXct(TIMESTAMP)) %>%
  tibble::column_to_rownames("TIMESTAMP")

xTs <- as.xts(Ts)
ep <- endpoints(xTs, on = "days")
Ts_daily <-period.apply(xTs, INDEX = ep, FUN = colMeans, na.rm = TRUE)
plot(Ts_daily)
```
